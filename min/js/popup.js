
document.addEventListener('DOMContentLoaded',function(){document.getElementById("theBody").addEventListener('scroll',OnScroll);document.getElementById("pin").addEventListener('click',OnClickPin);document.getElementById("session").addEventListener('click',OnClickSave);document.getElementById("local").addEventListener('click',OnClickSave);document.getElementById("deleteStorage").addEventListener('click',OnClickUnSave);document.getElementById("import").addEventListener('click',OnClickButtonImport);document.getElementById("btnHiddenImport").addEventListener('change',OnChangeImport);document.getElementById("export").addEventListener('click',OnClickExport);document.getElementById("removeAll").addEventListener('click',OnClickRemoveAllHighlights);document.getElementById("report").addEventListener('mousedown',OnClickButtonDetailAllHighlights);document.getElementById("cancel").addEventListener('click',OnClickPrevNext);document.getElementById("prev").addEventListener('click',OnClickPrevNext);document.getElementById("next").addEventListener('click',OnClickPrevNext);document.getElementById("quicklanguage").addEventListener('click',OnClickQuickLanguageButton);document.getElementById("allnotes").addEventListener('click',OnClickVisibilityButtons);document.getElementById("selectImportURL").addEventListener('change',OnChangeSelectImport);document.getElementById("selectImportURL").addEventListener('keyup',OnChangeSelectImport);document.getElementById("import_gotourl").addEventListener('click',OnClickButtonImportBarGotoURL);document.getElementById("import_import").addEventListener('click',OnClickButtonImportBarImport);document.getElementById("import_close").addEventListener('click',OnClickButtonImportBarClose);document.getElementById("selectTransHLSrcLang").addEventListener('change',OnChangeQuickTransLanguage);document.getElementById("selectTransHLSrcLang").addEventListener('keyup',OnChangeQuickTransLanguage);document.getElementById("selectTransHLDestLang").addEventListener('change',OnChangeQuickTransLanguage);document.getElementById("selectTransHLDestLang").addEventListener('keyup',OnChangeQuickTransLanguage);document.getElementById("quicklanguagebar_reset").addEventListener('click',OnClickButtonResetQuickLanguage);document.getElementById("quicklanguagebar_set").addEventListener('click',OnClickButtonApplyQuickLanguage);document.getElementById("quicklanguagebar_close").addEventListener('click',OnClickButtonCloseQuickLanguage);document.getElementById("removedonate").addEventListener('click',OnClickButtonRemoveDonate);OnLoad();});var DONATE_MODULO=20;var ENABLE_QL_RETRANSLATEALL=true;var ENABLE_ALLTRANS=false;var BUG_68135_NOCACHE=true;var KEYNAME_EXPORTPAGEHIGHLIGHTS="TemporaryExportPage";var LANGUAGENAME_AUTO="Auto Detected";var LIMIT_DAILY_TRANSLATEDCHARS=(100000-5000);var TIMEOUT_IMGWAITING=15000;var INNERTEXT_EMPTYNOTE="Enter your note here";var ROWS_NOTE=5;var WIDTH_HR_SNIPPETGROUPSEPERATOR="40px";var OPACITY_DISABLED=0.4;var OPACITY_ENABLED=1;var MARGINLEFT_BUTTONGROUP_ADDREMDEL=4;var PROMPT_IMPORTURL_MESSAGE="Enter the URL of the exported highlights (including protocol, such as http:// or https://)";var PROMPT_IMPORTURL_DEFAULTVALUE="http://";var CONFIRM_FORCEIMPORT="The URL of the page associated with these highlights doesn't match that of the current page.\n\nDo you wish to try and import them anyway?";var SHORTCUT_FIND_NEXT="j";var SHORTCUT_FIND_PREV="k";var SHORTCUT_FIND_CANCEL="x";var SHORTCUT_FIND_TOP="ctrl+k";var SHORTCUT_FIND_BOTTOM="ctrl+j";var SHORTCUT_SHOWTRANSHL="t";var SHORTCUT_ALLTRANSHL="ctrl+t";var SHORTCUT_QUICKLANGUAGE="q";var SHORTCUT_SPEAKSNIPPET="y";var SHORTCUT_SELECTHL="s";var SHORTCUT_SHOWTIP="m";var SHORTCUT_LOOKUPHIGHLIGHT="l";var SHORTCUT_REMOVEHL="delete";var SHORTCUT_SHOWNOTE="n";var SHORTCUT_ALLNOTES="ctrl+n";var TOOLTIP_HIGHLIGHT="Click to flash highlight & scroll into view. Add [Alt] to just flash, [Ctrl] to alternate pin behaviour, [Shift] to select."
var TOOLTIP_PININ="Pull pin to allow popup to close when a highlight is clicked. Add [Ctrl] to temporarily push pin whilst clicking a highlight.";var TOOLTIP_PINOUT="Push pin to keep popup window open when a highlight is clicked. Add [Ctrl] to temporarily push pin whilst clicking a highlight.";var TOOLTIP_ADDNOTE="Add Note";var TOOLTIP_REMOVENOTE="Delete Note";var TOOLTIP_REMOVEHIGHLIGHT="Remove Highlight ["+SHORTCUT_REMOVEHL+"]";var TOOLTIP_SELECTHIGHLIGHT="Select Highlight ["+SHORTCUT_SELECTHL+"]";var TOOLTIP_LOOKUP="Lookup Highlight ["+SHORTCUT_LOOKUPHIGHLIGHT+"]";var TOOLTIP_HIDETRANSHL="Show snippet in native language ["+SHORTCUT_SHOWTRANSHL+"]";var TOOLTIP_SHOWTRANSHL="Show snippet translated into <<LANGUAGE>> ["+SHORTCUT_SHOWTRANSHL+"]\nAdd [Alt] for alternate style";var TOOLTIP_SHOWNOTE="Reveal Note ["+SHORTCUT_SHOWNOTE+"]";var TOOLTIP_HIDENOTE="Hide Note ["+SHORTCUT_SHOWNOTE+"]";var TOOLTIP_SHOWTIP="Show Tip for Highlight ["+SHORTCUT_SHOWTIP+"]";var TOOLTIP_SPEAKSNIPPET="Speak Snippet ["+SHORTCUT_SPEAKSNIPPET+"]\nAdd [Alt] to use alternate speech service, [Shift] for native speech service.\nSelect spoken language by using the flag icon above.";var TOOLTIP_QLBARSRCFLAG="Translation Source Language, and Untranslated Speech Language: <<LANGUAGE>> ["+SHORTCUT_QUICKLANGUAGE+"]";var TOOLTIP_QLBARDESTFLAG="Translation Destination Language, and Translated Speech Language: <<LANGUAGE>> ["+SHORTCUT_QUICKLANGUAGE+"]";var TOOLTIP_TRANSLATEDSNIPPET_SPANSOURCE_FROMTO="Translated from <<SRCLANGUAGE>> into <<DESTLANGUAGE>>";var TOOLTIP_TRANSLATEDSNIPPET_SPANSOURCE_TO="Translated into <<DESTLANGUAGE>>";var TOOLTIP_WAITING="Loading...";var TOOLTIP_SHOWTRANSLATIONS="Show all snippets translated into <<LANGUAGE>> ["+SHORTCUT_ALLTRANSHL+"]";var TOOLTIP_HIDETRANSLATIONS="Show all snippets in native language ["+SHORTCUT_ALLTRANSHL+"]";var TOOLTIP_SHOWNOTES="Reveal all notes ["+SHORTCUT_ALLNOTES+"]";var TOOLTIP_HIDENOTES="Hide all notes ["+SHORTCUT_ALLNOTES+"]";var TOOLTIP_INFORMATION_TRANSHL_DESTLANG="Showing snippet translated into <<DESTLANGUAGE>>.";var TOOLTIP_INFORMATION_TRANSHL_SRCDESTLANG="Showing snippet translated from <<SRCLANGUAGE>> into <<DESTLANGUAGE>>.";var TOOLTIP_SOURCESNIPPET="Native Snippet: <<SNIPPET>>"
var TOOLTIP_TEXTAREA="Press TAB or click away from the text box to finish editing";var TOOLTIP_NOTE="Click to edit note";var TOOLTIP_TITLEBAR_SESSION="Page highlights last saved into temporary (green) storage";var TOOLTIP_TITLEBAR_LOCAL="Page highlights last saved into persistent (red) storage";var TOOLTIP_TITLEBAR_UNSAVED="Page highlights in their current state are not stored";var ERROR_TRANSLATION="Translation error: <<ERROR>>";var ERROR_IMGWAITING="Timeout whilst waiting for translation";var INFOBAR_INCOGNITO="Automatic storage of highlights is disabled in Incognito mode";var INFOBAR_TRANSLATEDCHARS="Amount of translated characters approaching Google daily limit";var SUMMARY_FORMAT_HEAD_TITLE="Highlights for <<TITLE>>";var SUMMARY_UNTITLED="Untitled Page";var SUMMARY_FORMAT_BODY_TITLE='<<LOGO>>Highlights for "<<TITLE>>"';var SUMMARY_FORMAT_SUBFRAME_INNERHTML="Subframe (<<ANCHOR>>)"
var SUMMARY_SUBFRAME_UNTITLED="Untitled";var SUMMARY_INNERHTML_FOOTER='Generated by <a href="https://chrome.google.com/extensions/detail/hljnlfolmbmibdjaikiaepgepgnldclj">Simple Highlighter</a> on <<DATE>>';var SUMMARY_BASE64_IMG_LOGO_48="iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAZdEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjVJivzgAAAI/klEQVRoQ+2Ze3BU9RXHs7vZJe9NsmzIiwRLCCVIeAVIQhJINkSygRCCNDFEHinlKQwQobyqoBWsSEVl1BGLMnXoCEwpLbUy2hYQywgKpZaXUBUiQoBAgLyT3W+/527u8hhA3M1C/vDOnNnXvef3Od97fud37m+9vH482kwBX3qKpvm3mcf75EjA19Au02y0q7R1NON9Gt+tYUJ59S4aTEEaZA3QIbyjBvKZ9hlNfm+3R3grJLL6eaPy/UC0HPLDlS/0KMh1BrGP55jaYwSxhDoqSuen6nHt74T/TxBsZyywX0xE/VkvFFiVuyAmQbSrO9GDQKcE7vEcA+p2BqHlcAzsdfvgOOxA3TNoOO2NgkfaXzolEfyswM8u9EHDLsIfiYe94UgrfOtLw07YT/uj9rABBdnaG+/EA02nDIJXazReWFrqi6aPBb4noMDbrgfQsAv2ilDYThr4uw9q9vli1FDdA0+nkYSv1Wm98NvpfmgW+GP9CX+A7BeYNbWOIBT4YNhOOOBlUjd/5o+aXYHIGej9wKpTKeEbDd5eeKvcX4G3HUsG6j8BWr4kdwUDuMjPOxzK3wLfvDcQzbuNqP5rMHKS9Pc9naYTvsXHoMGmXwU4lD+eDtTuAJo+ZQCHHEHUbSF8iDNtVOVV+KaPgtH0t1Bc3mzCsD4GNYi99O3nqRKroeOlNLvRX4MPVlJFgT/BMlmzlanCAJp30RhE7duE5125g/IqfONfTGj8oxnVvw+DpZcziF96IgAtna4SeFOgFnvWGB1pcyIH9qsbmCqbqP42GoOoeYXwxnuGb3gvDA3vhuPoqjBoWQw4xsdtHYA3HUofg2iTFgdea4U/mQt79VqmyjqgkUE0vgdcW+lQvrXa3CltVOVV+Pp3InDu1QjodUoAB9syAGnKNgl8XKQOx9YHo3kP1f1fHuyXV1Lt1UydV2lvAleXsM4H/GDlBb7+rSisLg5W58H6tgoggI52CHxiF2+cejeE8CyHJwlftRj2a08zdZ6jvQhcmUP4QJfhN88wwaBTVugaWs+2CEBWxz0Cn9Jdj+/+EEp4qShWVsfZzPtyps5CGoOonuJQ3oW0EeU/mGeGHysax2qijWoL+Eg6OSTwOX0NuLRF4GUVHQ77+TLYr0xhlZlJm8c0KiW8n8vK71kUBqOv0la00GRtcfvoSg8nBH5MSgdc3WoivImALJWVxZy04wg+gblP1S8VKr3NvZbKGyesKH9wWSeYWdGkstFmu03emnsVAl9m8UXtNoHvSMAhsJ8dSbULCP4oK00J5wBTSZR3MW2OrwhHTKjSCwn8UzRZY9w6knn1BXpBeb4f6rnANH9ihu3LVNi/y6baOQS3stKMInwm4X1dVv7r30QgvpOzB3qpLeAtdHJFFpHlRQFo3C7wYbAdT+LDCAOoYptwbSgrzTBO4BS34M+9FIk+Mc4V922OKwuky8dQXvkOrU46ypfLAiELjMC3HEuE7dt+hE+i6gMJnwb7BX4+7eNy2lS9EoX0bh3UWr+V4xpcJueFBbRGyXeDtwYbZhmdyrcc7cFmMoFqs6+/ksgy2Z/wPQnfweW0qV4bhdxePir8RxzXxx34Eby4XqPRwhgRi3VPmK/DH+kK2+muBI4jfDxwmYGcj3MLvua1aBQN8FPhP+XYbm2tyGz/tygfEhOP7ikWFJUMR+UOps1/O8F2qjPhO1P1WMIzkMpYB7yL1abu9WhMHxqgwh/muGZ3lJdrg2hNOkMH/CQpA8m5hcgtnoTyhRNQ9YWJaocQPgK4FE34SMIbXE4bgV8wPEiF/4rjxrgLL9fraAfkDoTHJSBtxFgUT5mNaU8uxQtr5qD6tBGoCob9nNkt+Po3ovF8YTDkWZljyQN/fFvAqz4G8E2Lwc8f/S0jMfbnM1H+1HMof3oFfr3qCVw+aSS83uW0Efg3SkPV3l62Fvu1Jbzqa4+XRoOE5EzkjB2v3IFZi5ZhavkSLFo2GRcPhtz0AH7rY+Dt+nlpDwR+42QT+3qlObtGS/cEvPh8WdIoYWAaskaXoGTaHMxZ+iwmzV7geD9/HCrZRsjuwQ+B3z7LDF+9Ai8l2uopePG7VgLom25BXkkZfsY0mvrkEkyZtxhjy2Zi1ONT8IsZY1D5oVnZPbj1GfbWxkyU3z2/EwJ9FPhmWokn4cX3Xg1TyFJQpMBPmjUfk+cuxES+jps2F1ZWJsuYUoybOAJn/tRJ2T24W9rsXxwOk7/SWcpW+gxPwyeISsaQ0JvgS6fPReHEaRg9YRoKJkxFRn6xUmbHFGWjYmOEsntwO+UPL49AdIhzl22Rp+FlIdsi6ZOUlulUXoWXNSGz4DFYCscpkzspOx+9h+TCOjIDFeujlN0D9RlW0uarFZGIMzs7y9X063Zb/H0CTBb44FATJswsV9LmOvxEBT6FqvfNysPAnAIMzhuLhLQcdBuUCcuwQfhmbWflAVzgz7wQhcQo567am/TrVmf5feDyu7Id6K3XI794/F3hEwYPQ9zAoehJ+L5ZI/BQ/wx07p2K9Ix++PrFGJxfHYXUrs7OcjP96u8FwJ1zonhxjVarQ6Z11C3wjrRRlVfhY/oMRuTDg9hyDMFPU7IRwfdhPZKQktoHwx4OvLGz7OAO2L1cKw3U55I6I7IC8Mzzs5T0kQmbW3xz2gh8bOIgmGLiEBgWhQBzFIyd4xCdmIzYvmlKAObu/aD3cwbw6L0AuHNORxU+N02H2uN6VJ0Mxvwlk5D3WNlNyj/UawD8gkJUZW961eq8ERzZBeb43jD4Oxu0f9K3bHx57BB4+VcQAl9zTM8OU8vnXAPO/SMM48tGI3l4IfpkWmGKjIG0FnJua8CL+Tq6dd78jq91jt+c5+zkZ+lsPXY4lbemE/4o4S9oYPtGj+b9/mj6MAQVG6JhyUlDQEhHFVz+48q/A1E3fv9n2m7acprH/7jeqCg/mPCf+8B+Rsc2WQP7tzq0HPVB4/uh2L4gFAE+zv+q/sXzwzwmpwuO90svnjlIi7xsjcMy+T5DB2uqN6wDDOp2niz922jt6i9PibeIJu3sbSdl6/eykSoLW7s9gknW5S4mv/94eEKB/wORycr8Zu1jWQAAAABJRU5ErkJggg=="
var CLASS_SPAN_ADDREMDEL="addremdel";var CLASS_TEXTAREA_EDITNOTE="editnote";var CLASS_HL="hlText";var CLASS_NOTE="note";var CLASS_SELECTHL="selecthl";var CLASS_LOOKUP="lookup";var CLASS_REMOVEHL="removeHL";var CLASS_WAITING="waiting";var CLASS_REMOVENOTE="removenote";var CLASS_ADDNOTE="addnote";var CLASS_INFORMATION="information";var CLASS_INFORMATION_IMG="imginfo";var CLASS_SHOWTRANSHL="showtranshl";var CLASS_SHOWTRANSHL_IMG="showtranshlimg";var CLASS_SHOWNOTE="shownote";var CLASS_SHOWNOTE_IMG="shownoteimg";var CLASS_SHOWTIP="showtip";var CLASS_SPEAKSNIPPET="speak"
var CLASS_APPENDEDTRANSLATION="appendedTranslation";var CLASS_SPEECH="spanspeech";var CLASS_SPEECH_FLAG="speechflag";var CLASS_SPEECH_ACTIVE="speechactive";var CLASS_SPANSOURCE="spansource";var CLASS_SPANSOURCE_FLAG="sourceflag";var CLASS_SPANSOURCE_DIRECTION="sourcedirection";var CLASS_QL_BUTTONSELECTED="quicklanguagebuttonselected";var CLASS_IMPORT_BUTTONSELECTED="importbuttonselected";var CLASS_BUTTONSELECTED="buttonselected"
var CLASS_HEADERBUTTONIMAGE="headerbuttonimage";var ID_ANCHOR_REMOVEALLHIGHLIGHTS='removeAll';var ID_SPAN_FINDCURSOR="findcursor";var ID_ANCHOR_ALLNOTES="allnotes";var ID_ANCHOR_ALLTRANS="alltrans";var ID_ANCHOR_QUICKLANGUAGE="quicklanguage";var ID_ANCHOR_IMPORT="import";var ID_DIV_QUICKLANGUAGEBAR="quicklanguagebar";var ID_DIV_IMPORTBAR="importbar";var ID_BUTTON_IMPORTBAR_GOTOURL="import_gotourl";var ID_SELECT_IMPORTURL="selectImportURL";var ID_SPAN_IMPORTBARTEXT="importbartext";var ID_SPAN_NUMTRANSLATEDCHARS="numtranslatedchars";var ID_DIV_HIGHLIGHTS="highlights";var ID_DIV_NOHIGHLIGHTS="nohighlightsmessage";var ID_ANCHOR_EXPORT="export";var ID_BUTTON_QLBAR_SET="quicklanguagebar_set";var ID_BUTTON_QLBAR_RESET="quicklanguagebar_reset";var ID_BUTTON_QLBAR_SRCFLAG="quicklanguagebarsrcflag";var ID_BUTTON_QLBAR_DESTFLAG="quicklanguagebardestflag";var ID_SPAN_QLBAR_TRANSLATEDTODAY="translatedtoday";var ID_BUTTON_DELETESTORAGE="deleteStorage";var ID_BUTTON_SAVESESSION="session";var ID_BUTTON_SAVELOCAL="local";var ID_BUTTON_DETAILHIGHLIGHTS="report";var ID_DIV_DONATE="donate";var ID_OL_HIGHLIGHTS="orderedlistHighlights";var MSG_SNIPPETSENT="popupSnippetSent";var MSG_REGISTERFRAME="popupRegisterFrame";var MSG_ONEXPORTEDFRAME="popupExportedFrame";var MSG_ONDETAILHIGHLIGHTSFRAME="popupDetailHighlightsFrame";var COLOUR_MOUSEOVER="red";var COLOUR_MOUSEOUT_NOTE="#EBB432"
var COLOUR_MOUSEOUT_SHOWINGTRANSLATED="#2CA4DF";var COLOUR_TRANSLATEDSNIPPET="#e2f2ff";var _indexCurrentHighlight;var _totalNumHighlights;var _marginLeft;var _pageYOffsetTryAfterSnippetSent;var _disableStorePopupPageYOffset=false;var _currentTargetListItemMouseOver=null;var _msgSetPopupTranslatedSnippet="setPopupTranslatedSnippet_"+RandomString(8);var _msgSetPopupSpeakSnippet="setPopupSpeakSnippet_"+RandomString(8);var _registeredFrameCount=0;var _reportedFrameCount=0;var _exportAsXml=false;var _arrDetailHighlights=[];var _saveDetailHighlights=false;var _relativeDateDetailHighlights=false;var _arrPrefToClassName=[{prefHL:PREFERENCE_HL1,className:"cl1"},{prefHL:PREFERENCE_HL2,className:"cl2"},{prefHL:PREFERENCE_HL3,className:"cl3"},{prefHL:PREFERENCE_HL4,className:"cl4"},{prefHL:PREFERENCE_HL5,className:"cl5"},{prefHL:PREFERENCE_HL6,className:"cl6"},{prefHL:PREFERENCE_HL7,className:"cl7"}];function _PrefHLToClassName(prefHL){for(var i=0;i<_arrPrefToClassName.length;i++){if(_arrPrefToClassName[i].prefHL==prefHL)
return _arrPrefToClassName[i].className;}
return null;};function OnLoad(){chrome.extension.onRequest.addListener(function(request,sender,sendResponse){if(request.msg==MSG_ONEXPORTEDFRAME){OnExportedFrame(request.key);}
else if(request.msg==MSG_ONDETAILHIGHLIGHTSFRAME){OnDetailHighlightsFrame(request.hrefHashRemoved,request.title,request.arrHighlights);}
else if(request.msg==MSG_REGISTERFRAME){_registeredFrameCount++;}
else if(request.msg==MSG_SNIPPETSENT){OnSnippetSent(request.arrayInfo,{msgScrollIntoView:request.msgScrollIntoView,msgSetNote:request.msgSetNote,msgRemoveHighlight:request.msgRemoveHighlight,msgSelectHighlight:request.msgSelectHighlight,msgShowTipPopup:request.msgShowTipPopup,msgSetShowStatus:request.msgSetShowStatus,msgSetTranslatedSnippet:request.msgSetTranslatedSnippet,msgLookupHighlight:request.msgLookupHighlight,},sender.tab,{showAllTrans:request.stateShowAllTrans,showAllNotes:request.stateShowAllNotes,});}else if(request.msg==_msgSetPopupTranslatedSnippet)
OnSetPopupTranslatedSnippet(request.index,request.data);else if(request.msg==_msgSetPopupSpeakSnippet)
OnSetPopupSpeakSnippet(request.index,request.data,request.templateId);});_marginLeft=GetScrollBarWidth()+parseFloat(window.getComputedStyle(document.body)["margin-right"]);document.body.style.setProperty("margin-left",_marginLeft+"px");document.body.style.setProperty("margin-right",_marginLeft+"px");arrayPrefs=GetPreference([PREFERENCE_HIGHLIGHTSTYLE,PREFERENCE_HIGHLIGHTSTYLE_TILE_BORDER_RADIUS,PREFERENCE_HIGHLIGHTSTYLE_TILE_BOX_SHADOW,PREFERENCE_HIGHLIGHTSTYLE_TILE_PADDING,PREFERENCE_HIGHLIGHTSTYLE_TILE_ALPHA_SHADOW,PREFERENCE_HIGHLIGHTSTYLE_SMEAR_BORDER_RADIUS,PREFERENCE_HIGHLIGHTSTYLE_SMEAR_BOX_SHADOW,PREFERENCE_HIGHLIGHTSTYLE_SMEAR_PADDING,PREFERENCE_HIGHLIGHTSTYLE_SMEAR_ALPHA_SHADOW,PREFERENCE_HL1,PREFERENCE_HL2,PREFERENCE_HL3,PREFERENCE_HL4,PREFERENCE_HL5,PREFERENCE_HL6,PREFERENCE_HL7,PREFERENCE_SHOWTRANSLATEDSNIPPETS,PREFERENCE_SHOWNOTES]);_arrPrefToClassName.forEach(function(h){var styleElement=document.createElement('style');styleElement.textContent="."+h.className+" {\
   text-decoration: none; "+
GetStyleElementText(arrayPrefs,arrayPrefs[h.prefHL],"popup")+" }";document.head.appendChild(styleElement);});var arr=[{shortcut:SHORTCUT_FIND_NEXT,arg:"next"},{shortcut:SHORTCUT_FIND_PREV,arg:"prev"},{shortcut:SHORTCUT_FIND_CANCEL,arg:"cancel"},{shortcut:SHORTCUT_FIND_TOP,arg:"top"},{shortcut:SHORTCUT_FIND_BOTTOM,arg:"bottom"},];for(var e in arr){shortcut.add(arr[e].shortcut,function(event,keys,opt){_OnClickPrevNext(opt.callbackData.arg);},{'disable_in_input':true,propagate:true,callbackData:{arg:arr[e].arg}});}
shortcut.add(SHORTCUT_SHOWTRANSHL,function(){var anchor=GetAnchorFromClassName(CLASS_SHOWTRANSHL);if(anchor){var targetOld=_currentTargetListItemMouseOver;OnClickToggleTranslateSnippet({currentTarget:anchor,ctrlKey:false});if(_currentTargetListItemMouseOver==null)
_currentTargetListItemMouseOver=targetOld;}},{'disable_in_input':true,propagate:true});if(ENABLE_ALLTRANS==true){shortcut.add(SHORTCUT_ALLTRANSHL,function(){_OnClickVisibilityButtons(document.getElementById(ID_ANCHOR_ALLTRANS));},{'disable_in_input':true,propagate:true});}
shortcut.add(SHORTCUT_QUICKLANGUAGE,function(){OnClickQuickLanguageButton();},{'disable_in_input':true,propagate:true});var arr=[{shortcut:SHORTCUT_SPEAKSNIPPET,className:CLASS_SPEAKSNIPPET,func:OnClickSpeakSnippet},{shortcut:SHORTCUT_SELECTHL,className:CLASS_SELECTHL,func:OnClickSelectHighlight},{shortcut:SHORTCUT_SHOWTIP,className:CLASS_SHOWTIP,func:OnClickShowTip},{shortcut:SHORTCUT_LOOKUPHIGHLIGHT,className:CLASS_LOOKUP,func:OnClickLookupHighlight},{shortcut:SHORTCUT_REMOVEHL,className:CLASS_REMOVEHL,func:OnClickRemoveHighlight},{shortcut:SHORTCUT_SHOWNOTE,className:CLASS_SHOWNOTE,func:OnClickToggleShowNote},];for(var d in arr){shortcut.add(arr[d].shortcut,function(event,keys,opt){var anchor=GetAnchorFromClassName(opt.callbackData.className);if(anchor)
opt.callbackData.func({currentTarget:anchor,ctrlKey:true});},{'disable_in_input':true,propagate:true,callbackData:{className:arr[d].className,func:arr[d].func}});}
shortcut.add(SHORTCUT_ALLNOTES,function(){_OnClickVisibilityButtons(document.getElementById(ID_ANCHOR_ALLNOTES));},{'disable_in_input':true,propagate:true});if(ENABLE_ALLTRANS==true)
SetSelectedButtonState(ID_ANCHOR_ALLTRANS,arrayPrefs[PREFERENCE_SHOWTRANSLATEDSNIPPETS]==PREFBOOL_TRUE?false:true);SetSelectedButtonState(ID_ANCHOR_ALLNOTES,arrayPrefs[PREFERENCE_SHOWNOTES]==PREFBOOL_TRUE?false:true);PopulateLanguages("selectTransHLSrcLang",{prependAuto:true,bing:true});PopulateLanguages("selectTransHLDestLang",{bing:true});document.getElementById("selectTransHLSrcLang").value=GetPreference(PREFERENCE_TRANSSNIPPET_SRCLANG_BING);document.getElementById("selectTransHLDestLang").value=GetPreference(PREFERENCE_TRANSSNIPPET_DESTLANG_BING);document.getElementById(ID_BUTTON_QLBAR_RESET).disabled=(GetPreference(PREFERENCE_TRANSSNIPPET_SRCLANG_BING,true)==GetPreference(PREFERENCE_TRANSSNIPPET_SRCLANG_BING)&&GetPreference(PREFERENCE_TRANSSNIPPET_DESTLANG_BING,true)==GetPreference(PREFERENCE_TRANSSNIPPET_DESTLANG_BING))?true:false;SetQuickLanguageFlag();ClearList();PopulateList();}
function OnScroll(){if(_disableStorePopupPageYOffset==false&&document.SimpleHighlight&&document.SimpleHighlight.tab){chrome.tabs.sendRequest(document.SimpleHighlight.tab.id,{msg:"setPopupPageYOffset",popupPageYOffset:window.pageYOffset});}}
function OnSetPopupTranslatedSnippet(index,data){var elemsLI=document.getElementsByTagName("li");if(index>=elemsLI.length)
return;var spanWaiting=elemsLI[index].getElementsByClassName(CLASS_WAITING)[0];spanWaiting.style.display="none";if(spanWaiting.timerID!=null){clearTimeout(spanWaiting.timerID);spanWaiting.timerID=null;}
SetItemError(index,data.error);if(data.error){ShowTranslatedSnippet(false,index);return;}
if(data.note){if(document.SimpleHighlight&&document.SimpleHighlight.tab){if(elemsLI[index].SimpleHighlight){chrome.tabs.sendRequest(document.SimpleHighlight.tab.id,{msg:elemsLI[index].SimpleHighlight.msgSetTranslatedSnippet,index:index,data:data});}}
elemsLI[index].SimpleHighlight.spanAddRemDel.aInfo.nameSrcLanguage=data.nameSrcLanguage;elemsLI[index].SimpleHighlight.aAppendedTranslation.spanSource.nameSrcLanguage=data.nameSrcLanguage;elemsLI[index].SimpleHighlight.aAppendedTranslation.spanSource.nameDestLanguage=data.nameDestLanguage;elemsLI[index].SimpleHighlight.aAppendedTranslation.spanSource.urlSrcLanguageIcon=data.urlSrcLanguageIcon;elemsLI[index].SimpleHighlight.aHighlight.translatedSnippet=data.note;if(elemsLI[index].SimpleHighlight.aHighlight.translatedSnippet!=null&&elemsLI[index].SimpleHighlight.aHighlight.translatedSnippet.length!=0)
ShowTranslatedSnippet(true,index);document.getElementById(ID_SPAN_NUMTRANSLATEDCHARS).innerText=AddCommas(GetPreference(PREFERENCE_TRANSLATEDCHARS));}}
function OnSetPopupSpeakSnippet(index,data,templateId){var li=GetElementFromIndex(index);var spanWaiting=li.SimpleHighlight.spanWaiting;function StopWaitingImage(span){span.style.display="none";if(span.timerID!=null){clearTimeout(span.timerID);span.timerID=null;}}
var aSpeakSnippet=li.SimpleHighlight.spanAddRemDel.aSpeakSnippet;if(!data.url&&!aSpeakSnippet.audio){StopWaitingImage(spanWaiting);}
else{var audio,idSpeechBy;var spanSpeech=li.SimpleHighlight.spanSpeech;if(aSpeakSnippet.audio){audio=aSpeakSnippet.audio;if(audio.ended==true){var elemSpeechBy=document.getElementById(audio.idSpeechBy);elemSpeechBy.activeSpeechCount=(elemSpeechBy.activeSpeechCount?elemSpeechBy.activeSpeechCount:0)+1;elemSpeechBy.style.setProperty("display","","important");}
audio.currentTime=0;templateId=audio.templateId;spanSpeech.style.setProperty("display","");audio.play();}
else{audio=aSpeakSnippet.audio=document.createElement('audio');audio.controls=false;audio.aSpeakSnippet=aSpeakSnippet;audio.spanSpeech=spanSpeech;audio.templateId=templateId;audio.idSpeechBy=(templateId==ID_TIPPOPUP_GOOGLETTS?"speechByGoogle":"speechByBing");;audio.urlFallback=data.urlFallback;audio.speakTranslated=li.SimpleHighlight.showTranslated;spanSpeech.imgFlag.src=data.srcSpokenLanguageIcon;spanSpeech.imgFlag.title=data.spokenLanguageName;function OnEnded(e){e.currentTarget.spanSpeech.style.setProperty("display","none");var elemSpeechBy=document.getElementById(e.currentTarget.idSpeechBy);if(--elemSpeechBy.activeSpeechCount==0){elemSpeechBy.style.setProperty("display","none","important");}}
audio.addEventListener("error",OnEnded,false);audio.addEventListener("ended",OnEnded,false);aSpeakSnippet.appendChild(audio);function OnGetBase64(obj){if(obj.status==200&&obj.strBase64){obj.cbData.audio.src="data:audio/"+(templateId==ID_TIPPOPUP_GOOGLETTS?"mp3":"wav")+";base64,"+obj.strBase64;window.setTimeout(function(_a){_a.play();},100,obj.cbData.audio);obj.cbData.spanSpeech.style.setProperty("display","");StopWaitingImage(obj.cbData.spanWaiting);}
else if(obj.cbData.audio.urlFallback){var urlFallback=obj.cbData.audio.urlFallback;obj.cbData.audio.urlFallback=null;if(obj.cbData.srcSpokenLanguageIconFallback)
obj.cbData.spanSpeech.imgFlag.src=obj.cbData.srcSpokenLanguageIconFallback;if(obj.cbData.spokenLanguageNameFallback)
obj.cbData.spanSpeech.imgFlag.title=obj.cbData.spokenLanguageNameFallback;GetBase64StringFromBinaryURL(urlFallback,OnGetBase64,obj.cbData);}
else
StopWaitingImage(obj.cbData.spanWaiting);}
GetBase64StringFromBinaryURL(data.url,OnGetBase64,{audio:audio,spanSpeech:spanSpeech,srcSpokenLanguageIconFallback:data.srcSpokenLanguageIconFallback,spokenLanguageNameFallback:data.spokenLanguageNameFallback,spanWaiting:spanWaiting,});var elemSpeechBy=document.getElementById(audio.idSpeechBy);elemSpeechBy.activeSpeechCount=(elemSpeechBy.activeSpeechCount?elemSpeechBy.activeSpeechCount:0)+1;elemSpeechBy.style.setProperty("display","","important");}}}
function SetItemError(index,errorText){var aInfo=document.getElementsByTagName("li")[index].SimpleHighlight.spanAddRemDel.aInfo;aInfo.errorText=errorText;var imgInfos=aInfo.getElementsByClassName(CLASS_INFORMATION_IMG);if(imgInfos.length==1)
imgInfos[0].src="img/"+(errorText==null?"information-white":"exclamation-red")+".png";}
function OnListitemMouseOut(event){var spanAddRemDel=event.currentTarget.SimpleHighlight.spanAddRemDel
spanAddRemDel.style.display="none";if(event.currentTarget.SimpleHighlight.arrayInfo.note)
event.currentTarget.style.setProperty("color",COLOUR_MOUSEOUT_NOTE);else{if(event.currentTarget.SimpleHighlight.showTranslated==true){if(event.currentTarget.SimpleHighlight.aHighlight.translatedSnippet)
event.currentTarget.style.setProperty("color",COLOUR_MOUSEOUT_SHOWINGTRANSLATED);else
event.currentTarget.style.removeProperty("color");}
else
event.currentTarget.style.removeProperty("color");}
_currentTargetListItemMouseOver=null;}
function OnExportedFrame(key){_reportedFrameCount++;if(_reportedFrameCount==_registeredFrameCount){chrome.extension.sendRequest({msg:"loadHighlights",url:key,store:"session"},function(result){chrome.extension.sendRequest({msg:"exportHighlightFromStringifiedHL",url:document.SimpleHighlight.tab.url.RemoveHash(),stringifiedHL:JSON.stringify(result),asXml:_exportAsXml,});chrome.extension.sendRequest({msg:"saveHighlights",url:key,store:"session",arrayHighlights:null});});}}
function OnDetailHighlightsFrame(hrefHashRemoved,title,arrHighlights){_reportedFrameCount++;_arrDetailHighlights.push({hrefHashRemoved:hrefHashRemoved,title:title,arrHL:arrHighlights});if(_reportedFrameCount==_registeredFrameCount){var urlHashRemoved=document.SimpleHighlight.tab.url.RemoveHash();var dateNow=new Date();var arrayPrefs=GetPreference([PREFERENCE_HIGHLIGHTSTYLE,PREFERENCE_HIGHLIGHTSTYLE_TILE_BORDER_RADIUS,PREFERENCE_HIGHLIGHTSTYLE_TILE_BOX_SHADOW,PREFERENCE_HIGHLIGHTSTYLE_TILE_PADDING,PREFERENCE_HIGHLIGHTSTYLE_TILE_ALPHA_SHADOW,PREFERENCE_HIGHLIGHTSTYLE_SMEAR_BORDER_RADIUS,PREFERENCE_HIGHLIGHTSTYLE_SMEAR_BOX_SHADOW,PREFERENCE_HIGHLIGHTSTYLE_SMEAR_PADDING,PREFERENCE_HIGHLIGHTSTYLE_SMEAR_ALPHA_SHADOW,PREFERENCE_HL1,PREFERENCE_HL2,PREFERENCE_HL3,PREFERENCE_HL4,PREFERENCE_HL5,PREFERENCE_HL6,PREFERENCE_HL7]);var htmlDoc=document.createElement("html");var head=document.createElement("head");var title=document.createElement("title");title.innerText=SUMMARY_FORMAT_HEAD_TITLE.replace("<<TITLE>>",document.SimpleHighlight.tab.title.length>0?document.SimpleHighlight.tab.title:SUMMARY_UNTITLED);head.appendChild(title);var meta=document.createElement("meta");meta.httpEquiv="content-type";meta.content="text/html; charset=UTF-8";head.appendChild(meta);meta=document.createElement("meta");meta.httpEquiv="date";meta.content=dateNow.toLocaleString();head.appendChild(meta);var meta=document.createElement("meta");meta.httpEquiv="last-modified";meta.content=dateNow.toLocaleString();head.appendChild(meta);meta=document.createElement("meta");meta.name="author";meta.content="Simple Highlighter";head.appendChild(meta);meta=document.createElement("meta");meta.name="description";meta.content=title.innerText;head.appendChild(meta);meta=document.createElement("meta");meta.name="generator";meta.content="Simple Highlighter";head.appendChild(meta);_arrPrefToClassName.forEach(function(h){var styleElement=document.createElement('style');styleElement.textContent="."+h.className+" {\
      text-decoration: none; "+
GetStyleElementText(arrayPrefs,arrayPrefs[h.prefHL],"popup")+" }";head.appendChild(styleElement);});var styleElement=document.createElement('style');styleElement.textContent="\
      body {font-family: FrancoMedium, Garamond, Baskerville, Georgia, serif !important; }\
      .header{font-size: 64px; letter-spacing: -0.04em; font-weight: normal; font-style: italic; color: black; text-align: center;}\
       .logo {margin-right: 7px; }\
       .pageanchor{ text-decoration: none; }\
      .list{list-style-type: decimal; }\
       .list li{padding: 0.2em; }\
        .alternate{background: #efe;}\
        .textcomplete {font-size: small!important; padding: 0.2em!important; }\
        .date{font-size: small; color: lightgray; font-style: italic; margin-left: 1em; padding-top: 0.2em; float: right;}\
        .subframe{font-size: 16pt; font-weight: normal; font-style: italic; color: black; margin-left: -0.5em; margin-top: 2em; }\
         .subframeanchor{ text-decoration: none; }\
        .note{font-size: small; color: gray; margin-left: 1em; margin-top: 0.4em; border-left: 5px solid #EBB432; padding-left: 0.5em; }\
      .footer{text-align: right; font-size: small; color: black; margin-top: 5em; }";head.appendChild(styleElement);var commentElement=document.createComment("Modern Life Is Rubbish");head.appendChild(commentElement);htmlDoc.appendChild(head);var body=document.createElement("body");var h1=document.createElement("h1");h1.className="header";var aLogo=document.createElement("a");aLogo.className="logo";aLogo.href="https://chrome.google.com/extensions/detail/hljnlfolmbmibdjaikiaepgepgnldclj";var img48=document.createElement("img");img48.src="data:image/png;base64,"+SUMMARY_BASE64_IMG_LOGO_48;aLogo.appendChild(img48);var aPage=document.createElement("a");aPage.className="pageanchor";aPage.href=urlHashRemoved;aPage.innerText=document.SimpleHighlight.tab.title.length>0?document.SimpleHighlight.tab.title:SUMMARY_UNTITLED;var format=SUMMARY_FORMAT_BODY_TITLE.replace("<<LOGO>>",aLogo.outerHTML);h1.innerHTML=format.replace("<<TITLE>>",aPage.outerHTML);body.appendChild(h1);if(_arrDetailHighlights.length>0){var ul=document.createElement("ol");ul.className="list";for(var q=0;q<_arrDetailHighlights.length;q++){if(_arrDetailHighlights[q].arrHL.length==0)
continue;if(_arrDetailHighlights[q].hrefHashRemoved!=urlHashRemoved){var h2=document.createElement("h2");h2.className="subframe";var aSubFrame=document.createElement("a");aSubFrame.className="subframeanchor";aSubFrame.href=_arrDetailHighlights[q].hrefHashRemoved;aSubFrame.innerText=_arrDetailHighlights[q].title?_arrDetailHighlights[q].title:SUMMARY_SUBFRAME_UNTITLED;h2.innerHTML=SUMMARY_FORMAT_SUBFRAME_INNERHTML.replace("<<ANCHOR>>",aSubFrame.outerHTML);ul.appendChild(h2);}
for(var r=0;r<_arrDetailHighlights[q].arrHL.length;r++){var li=document.createElement("li");if(r%2==1)
li.className="alternate";var divDate=document.createElement("span");var date=new Date(_arrDetailHighlights[q].arrHL[r].date);divDate.innerText=(_relativeDateDetailHighlights==true?TimeAgo(date):date.toLocaleString());divDate.className="date";li.appendChild(divDate);var divTextComplete=document.createElement("span");divTextComplete.className=_PrefHLToClassName(_arrDetailHighlights[q].arrHL[r].prefHL)+" textcomplete";divTextComplete.innerText=_arrDetailHighlights[q].arrHL[r].textComplete;li.appendChild(divTextComplete);if(_arrDetailHighlights[q].arrHL[r].note){var divNote=document.createElement("div");divNote.className="note";divNote.innerText=_arrDetailHighlights[q].arrHL[r].note;li.appendChild(divNote);}
ul.appendChild(li);}}
body.appendChild(ul);}
var divFooter=document.createElement("div");divFooter.className="footer";divFooter.innerHTML=SUMMARY_INNERHTML_FOOTER.replace("<<DATE>>",dateNow.toLocaleString());body.appendChild(divFooter);htmlDoc.appendChild(body);var doc='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">'+htmlDoc.outerHTML;if(_saveDetailHighlights==false){var uriContent="data:text/html;charset=utf-8,"+doc;chrome.tabs.create({url:uriContent});}
else{var BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.BlobBuilder;var bb=new BlobBuilder();bb.append(doc);var blob=bb.getBlob();var windowURL=(window.webkitURL||window.URL);var objectURL=windowURL.createObjectURL(blob);chrome.tabs.create({url:objectURL});}}}
function OnSnippetSent(arrayInfo,msgs,tab,states){if(arrayInfo.length==0)
return;_totalNumHighlights+=arrayInfo.length;UpdateHeader();var ol=document.getElementById(ID_OL_HIGHLIGHTS);if(ol==null){ol=document.createElement('ol');ol.id=ID_OL_HIGHLIGHTS;document.getElementById(ID_DIV_HIGHLIGHTS).appendChild(ol);}
var elements=document.getElementsByClassName("li");if(elements.length>0){var seperator=document.createElement('hr');seperator.width=WIDTH_HR_SNIPPETGROUPSEPERATOR;ol.appendChild(seperator);}
if(states){if(ENABLE_ALLTRANS==true){if(states.showAllTrans!=null)
SetSelectedButtonState(ID_ANCHOR_ALLTRANS,states.showAllTrans);}
if(states.showAllNotes!=null)
SetSelectedButtonState(ID_ANCHOR_ALLNOTES,states.showAllNotes);}
if(ENABLE_ALLTRANS==true){var a=document.getElementById(ID_ANCHOR_ALLTRANS);if(a){a.lastValidTabId=tab.id;a.msgSetShowStatus=msgs.msgSetShowStatus;}}
var a=document.getElementById(ID_ANCHOR_ALLNOTES);if(a){a.lastValidTabId=tab.id;a.msgSetShowStatus=msgs.msgSetShowStatus;}
var arrPrefs=GetPreference([PREFERENCE_SHOWTRANSLATEDSNIPPETS,PREFERENCE_SHOWNOTES]);var numNotes=0;for(var i=0;i<arrayInfo.length;i++){var listItem=document.createElement("li");listItem.SimpleHighlight={arrayInfo:arrayInfo[i],indexRelativeToMessage:i,msgSetTranslatedSnippet:msgs.msgSetTranslatedSnippet,};listItem.addEventListener("mouseover",function(e){e.currentTarget.SimpleHighlight.spanAddRemDel.style.display="";e.currentTarget.style.setProperty("color",COLOUR_MOUSEOVER);_currentTargetListItemMouseOver=e.currentTarget;});listItem.addEventListener("mouseout",OnListitemMouseOut);var spanAddRemDel=listItem.SimpleHighlight.spanAddRemDel=document.createElement("span");spanAddRemDel.className=CLASS_SPAN_ADDREMDEL;spanAddRemDel.style.display="none";if(arrayInfo[i].note&&arrayInfo[i].note.length>0){var aShowNote=spanAddRemDel.aShowNote=document.createElement("a");aShowNote.href="#";aShowNote.className=CLASS_SHOWNOTE;aShowNote.innerHTML='<img class="'+CLASS_SHOWNOTE_IMG+'" src="img/note.png"/>';aShowNote.tabId=tab.id;aShowNote.msgSetShowStatus=msgs.msgSetShowStatus;aShowNote.addEventListener("click",OnClickToggleShowNote,true);spanAddRemDel.appendChild(aShowNote);numNotes++;}
var aShowTransHL=spanAddRemDel.aShowTransHL=document.createElement("a");aShowTransHL.href="#";aShowTransHL.className=CLASS_SHOWTRANSHL;aShowTransHL.style.marginLeft="1px";aShowTransHL.innerHTML='<img class="'+CLASS_SHOWTRANSHL_IMG+'" src="img/translate.png" />';aShowTransHL.tabId=tab.id;aShowTransHL.msgSetShowStatus=msgs.msgSetShowStatus;aShowTransHL.addEventListener("click",OnClickToggleTranslateSnippet,true);spanAddRemDel.appendChild(aShowTransHL);var aShowTip=spanAddRemDel.aShowTip=document.createElement("a");aShowTip.className=CLASS_SHOWTIP;aShowTip.href="#";aShowTip.innerHTML='<img src="img/balloon-ellipsis.png"/>';aShowTip.style.marginLeft=MARGINLEFT_BUTTONGROUP_ADDREMDEL+"px";aShowTip.title=TOOLTIP_SHOWTIP;aShowTip.msgShowTipPopup=msgs.msgShowTipPopup;aShowTip.msgScrollIntoView=msgs.msgScrollIntoView;aShowTip.tabId=tab.id;aShowTip.addEventListener("click",OnClickShowTip,true);spanAddRemDel.appendChild(aShowTip);var aLookup=spanAddRemDel.aLookup=document.createElement("a");aLookup.className=CLASS_LOOKUP;aLookup.href="#";aLookup.innerHTML='<img src="img/book-open-text.png"/>';aLookup.title=TOOLTIP_LOOKUP;aLookup.msgLookupHighlight=msgs.msgLookupHighlight;aLookup.tabId=tab.id;aLookup.addEventListener("click",OnClickLookupHighlight,true);spanAddRemDel.appendChild(aLookup);var aSpeakSnippet=spanAddRemDel.aSpeakSnippet=document.createElement("a");aSpeakSnippet.className=CLASS_SPEAKSNIPPET;var imgSpeakSnippet=aSpeakSnippet.imgSpeakSnippet=document.createElement('img');imgSpeakSnippet.src="img/speaker-volume-low2.png";aSpeakSnippet.appendChild(imgSpeakSnippet);aSpeakSnippet.title=TOOLTIP_SPEAKSNIPPET;aSpeakSnippet.href="#";aSpeakSnippet.style.marginLeft=(MARGINLEFT_BUTTONGROUP_ADDREMDEL+3)+"px";aSpeakSnippet.tabId=tab.id;aSpeakSnippet.addEventListener("click",OnClickSpeakSnippet,true);spanAddRemDel.appendChild(aSpeakSnippet);var aSelectHL=spanAddRemDel.aSelectHl=document.createElement("a");aSelectHL.className=CLASS_SELECTHL;aSelectHL.href="#";aSelectHL.innerHTML='<img src="img/selection-select-input.png"/>';aSelectHL.title=TOOLTIP_SELECTHIGHLIGHT;aSelectHL.msgSelectHighlight=msgs.msgSelectHighlight;aSelectHL.tabId=tab.id;aSelectHL.addEventListener("click",OnClickSelectHighlight,true);spanAddRemDel.appendChild(aSelectHL);var hasNote=(arrayInfo[i].note&&arrayInfo[i].note.length>0)?true:false;var aAction=spanAddRemDel.aAction=document.createElement("a");aAction.className=(hasNote==true?CLASS_REMOVENOTE:CLASS_ADDNOTE);aAction.href="#";aAction.innerHTML='<img src="img/'+(hasNote==true?'remove':'add')+'Note.png"/>';aAction.title=(hasNote==true?TOOLTIP_REMOVENOTE:TOOLTIP_ADDNOTE);aAction.addEventListener("click",hasNote==true?OnClickRemoveNote:OnClickAddNote,true)
aAction.tabId=tab.id;aAction.msgSetNote=msgs.msgSetNote;spanAddRemDel.appendChild(aAction);var aInfo=spanAddRemDel.aInfo=document.createElement("a");aInfo.className=CLASS_INFORMATION;aInfo.href="#";aInfo.innerHTML='<img class="'+CLASS_INFORMATION_IMG+'" style="margin-left: 2px"/>';aInfo.style.marginLeft=MARGINLEFT_BUTTONGROUP_ADDREMDEL+"px";aInfo.date=new Date(arrayInfo[i].date);aInfo.nameSrcLanguage=arrayInfo[i].nameSrcLanguage;aInfo.addEventListener("mouseover",function(event){var elemLI=GetElementFromIndex(GetListItemIndexFromParents(event.currentTarget));if(elemLI==null)
return;var title="";if(event.currentTarget.errorText){var format=ERROR_TRANSLATION;title+=format.replace("<<ERROR>>",event.currentTarget.errorText)+"\n\n";}
if(elemLI.SimpleHighlight.showTranslated==true){var srcLanguage;var destLanguage=Bing.GetLanguageInfo(GetPreference(PREFERENCE_TRANSSNIPPET_DESTLANG_BING)).name;if(event.currentTarget.nameSrcLanguage)
srcLanguage=event.currentTarget.nameSrcLanguage;var format=event.currentTarget.nameSrcLanguage?TOOLTIP_INFORMATION_TRANSHL_SRCDESTLANG:TOOLTIP_INFORMATION_TRANSHL_DESTLANG;format=format.replace("<<DESTLANGUAGE>>",destLanguage!=null?destLanguage:"?");format=format.replace("<<SRCLANGUAGE>>",srcLanguage!=null?srcLanguage:"?");title+=format+"\n\n";}
title+="Highlight created "+(event.altKey==true?event.currentTarget.date.toLocaleString():TimeAgo(event.currentTarget.date))+"\n\n"+TOOLTIP_HIGHLIGHT;event.currentTarget.title=title;});aInfo.addEventListener("click",function(e){e.returnValue=false;var elemLI=GetElementFromIndex(GetListItemIndexFromParents(e.currentTarget));elemLI.SimpleHighlight.aHighlight.dispatchEvent(e);},true);spanAddRemDel.appendChild(aInfo);var aRemoveHL=spanAddRemDel.aRemoveHL=document.createElement("a");aRemoveHL.className=CLASS_REMOVEHL;aRemoveHL.href="#";aRemoveHL.innerHTML='<img src="img/removeHighlight.png"/>';aRemoveHL.title=TOOLTIP_REMOVEHIGHLIGHT;aRemoveHL.msgRemoveHighlight=msgs.msgRemoveHighlight;aRemoveHL.tabId=tab.id;aRemoveHL.addEventListener("click",OnClickRemoveHighlight,true);spanAddRemDel.appendChild(aRemoveHL);listItem.appendChild(spanAddRemDel);var spanWaiting=listItem.SimpleHighlight.spanWaiting=document.createElement("span");spanWaiting.className=CLASS_WAITING;spanWaiting.style.display="none";var imgWaiting=spanWaiting.imgWaiting=document.createElement("img");imgWaiting.src="img/ajax-loader2.gif";imgWaiting.title=TOOLTIP_WAITING;imgWaiting.style.marginTop="2px";spanWaiting.appendChild(imgWaiting);listItem.appendChild(spanWaiting);var aHighlight=listItem.SimpleHighlight.aHighlight=document.createElement("a");aHighlight.className=_PrefHLToClassName(arrayInfo[i].prefHL)+" "+CLASS_HL;aHighlight.href="#";aHighlight.snippet=aHighlight.innerText=arrayInfo[i].snippet;aHighlight.translatedSnippet=arrayInfo[i].translatedSnippet;aHighlight.tabId=tab.id;aHighlight.msgScrollIntoView=msgs.msgScrollIntoView;aHighlight.msgSelectHighlight=msgs.msgSelectHighlight;aHighlight.addEventListener("click",OnClickHighlight,true);aHighlight.addEventListener("mouseover",function(event){var elemLI=GetElementFromIndex(GetListItemIndexFromParents(event.currentTarget));if(elemLI==null)return;var title="";if(elemLI.SimpleHighlight.showNote==false&&elemLI.SimpleHighlight.arrayInfo.note&&elemLI.SimpleHighlight.arrayInfo.note.length>0)
title+=elemLI.SimpleHighlight.arrayInfo.note;event.currentTarget.title=title;});listItem.appendChild(aHighlight);var aAppendedTranslation=listItem.SimpleHighlight.aAppendedTranslation=document.createElement("a");aAppendedTranslation.className=CLASS_APPENDEDTRANSLATION;aAppendedTranslation.style.setProperty("display","none");aAppendedTranslation.href="#";var spanSource=aAppendedTranslation.spanSource=document.createElement("span");spanSource.className=CLASS_SPANSOURCE;spanSource.nameSrcLanguage=arrayInfo[i].nameSrcLanguage;spanSource.nameDestLanguage=arrayInfo[i].nameDestLanguage;spanSource.urlSrcLanguageIcon=arrayInfo[i].urlSrcLanguageIcon;var imgFlag=spanSource.imgFlag=document.createElement("img");imgFlag.className=CLASS_SPANSOURCE_FLAG;spanSource.appendChild(imgFlag);var imgDirection=spanSource.imgDirection=document.createElement("img");imgDirection.className=CLASS_SPANSOURCE_DIRECTION;imgDirection.src="img/arrow-000-small-cropped.png";spanSource.appendChild(imgDirection);aAppendedTranslation.appendChild(spanSource);var spanText=aAppendedTranslation.spanText=document.createElement("span");aAppendedTranslation.appendChild(spanText);aAppendedTranslation.addEventListener("click",function(e){e.returnValue=false;var elemLI=GetElementFromIndex(GetListItemIndexFromParents(e.currentTarget));elemLI.SimpleHighlight.aHighlight.dispatchEvent(e);},true);listItem.appendChild(aAppendedTranslation);var spanSpeech=listItem.SimpleHighlight.spanSpeech=document.createElement("span");spanSpeech.className=CLASS_SPEECH;spanSpeech.style.setProperty("display","none");var imgActive=document.createElement("img");imgActive.className=CLASS_SPEECH_ACTIVE;imgActive.src="img/speaker-volume.png";spanSpeech.appendChild(imgActive);spanSpeech.imgFlag=document.createElement("img");spanSpeech.imgFlag.className=CLASS_SPEECH_FLAG;spanSpeech.appendChild(spanSpeech.imgFlag);listItem.appendChild(spanSpeech);if(arrayInfo[i].note&&arrayInfo[i].note.length>0){var divNote=listItem.SimpleHighlight.divNote=document.createElement("div");divNote.innerText=arrayInfo[i].note;divNote.className=CLASS_NOTE;divNote.title=TOOLTIP_NOTE;divNote.tabId=tab.id;divNote.msgSetNote=msgs.msgSetNote;divNote.addEventListener("click",OnClickNote);listItem.appendChild(document.createElement("br"));listItem.appendChild(divNote);}
ol.appendChild(listItem);SetItemError(GetListItemIndexFromParents(listItem),null);ShowTranslatedSnippet(arrayInfo[i].showTranslatedSnippet==null?(arrPrefs[PREFERENCE_SHOWTRANSLATEDSNIPPETS]==PREFBOOL_TRUE?true:false):arrayInfo[i].showTranslatedSnippet,GetListItemIndexFromParents(listItem));ShowNote(arrayInfo[i].showNote==null?(arrPrefs[PREFERENCE_SHOWNOTES]==PREFBOOL_TRUE?true:false):arrayInfo[i].showNote,GetListItemIndexFromParents(listItem));OnListitemMouseOut({currentTarget:listItem});}
if(numNotes>0)
document.getElementById(ID_ANCHOR_ALLNOTES).style.removeProperty("display");if(_pageYOffsetTryAfterSnippetSent!=null)
window.scrollTo(0,_pageYOffsetTryAfterSnippetSent);}
function OnClickToggleShowNote(e){e.returnValue=false;var elemLI=GetElementFromIndex(GetListItemIndexFromParents(e.currentTarget));if(elemLI==null)
return;ShowNote(elemLI.SimpleHighlight.showNote==true?false:true,GetListItemIndexFromParents(e.currentTarget));}
function OnClickToggleTranslateSnippet(e){e.returnValue=false;if(e.ctrlKey==true)
OnClickQuickLanguageButton();else{var index=GetListItemIndexFromParents(e.currentTarget);var elemLI=GetElementFromIndex(index);if(elemLI==null)
return;if(elemLI.SimpleHighlight.showTranslated!=true){var styleTranslation=GetPreference(PREFERENCE_POPUP_TRANSLATIONSTYLE);if(e.altKey==true)
styleTranslation=(styleTranslation==TRANSLATIONSTYLE_REPLACE?TRANSLATIONSTYLE_APPEND:TRANSLATIONSTYLE_REPLACE);elemLI.SimpleHighlight.styleTranslation=styleTranslation;}
ShowTranslatedSnippet(elemLI.SimpleHighlight.showTranslated==true?false:true,index);}}
function OnClickSelectHighlight(e){e.returnValue=false;chrome.tabs.sendRequest(e.currentTarget.tabId,{msg:e.currentTarget.msgSelectHighlight,index:GetListItemFromParents(e.currentTarget).SimpleHighlight.indexRelativeToMessage},function(){if(e.ctrlKey==false&&GetPreference(PREFERENCE_POPUP_PIN)!=PREFBOOL_TRUE)
window.close();});}
function OnClickShowTip(e){e.returnValue=false;chrome.tabs.sendRequest(e.currentTarget.tabId,{msg:e.currentTarget.msgScrollIntoView,index:GetListItemFromParents(e.currentTarget).SimpleHighlight.indexRelativeToMessage,alignToTop:e.altKey==true?false:true});chrome.tabs.sendRequest(e.currentTarget.tabId,{msg:e.currentTarget.msgShowTipPopup,index:GetListItemFromParents(e.currentTarget).SimpleHighlight.indexRelativeToMessage},function(){if(e.ctrlKey==false&&GetPreference(PREFERENCE_POPUP_PIN)!=PREFBOOL_TRUE)
window.close();});}
function OnClickSpeakSnippet(e){e.returnValue=false;if(e.currentTarget.disabled==true)
return;var index=GetListItemIndexFromParents(e.currentTarget);var elemLI=GetElementFromIndex(index);if(elemLI==null||elemLI.SimpleHighlight.aHighlight==null)
return;var audio=elemLI.SimpleHighlight.spanAddRemDel.aSpeakSnippet.audio;var idTTSTemplateID=GetPreference(PREFERENCE_POPUP_SPEECHSERVICE);if(e.shiftKey==true)
idTTSTemplateID=ID_TIPPOPUP_DUMMY_NATIVETTS;else if(e.altKey==true)
idTTSTemplateID=(idTTSTemplateID==ID_TIPPOPUP_MSTRANSLATE_TTS?ID_TIPPOPUP_GOOGLETTS:ID_TIPPOPUP_MSTRANSLATE_TTS);if(audio){if(audio.templateId==idTTSTemplateID&&audio.speakTranslated==elemLI.SimpleHighlight.showTranslated){OnSetPopupSpeakSnippet(index,{});return;}
audio.currentTime=99999;audio.parentElement.removeChild(audio);elemLI.SimpleHighlight.spanAddRemDel.aSpeakSnippet.audio=null;}
chrome.extension.sendRequest({msg:"nativeSpeak",stop:true,});var showTranslated=elemLI.SimpleHighlight.showTranslated;if(idTTSTemplateID==ID_TIPPOPUP_DUMMY_NATIVETTS){chrome.extension.sendRequest({msg:"nativeSpeak",utterance:(showTranslated==true?elemLI.SimpleHighlight.aHighlight.translatedSnippet:elemLI.SimpleHighlight.aHighlight.snippet),options:{lang:(GetPreference(showTranslated==true?PREFERENCE_TRANSSNIPPET_DESTLANG_BING:PREFERENCE_TRANSSNIPPET_SRCLANG_BING)),},});}
else{var spanWaiting=elemLI.SimpleHighlight.spanWaiting;if(spanWaiting){spanWaiting.style.display="";if(spanWaiting.timerID!=null)
clearTimeout(spanWaiting.timerID);spanWaiting.timerID=setTimeout(function(paramImg,paramIndex){OnSetPopupSpeakSnippet(index,{error:ERROR_IMGWAITING});},TIMEOUT_IMGWAITING,spanWaiting,index);}
var templateCloned=GetTipTemplateClone(idTTSTemplateID);if(templateCloned){templateCloned.options.language=(GetPreference(showTranslated==true?PREFERENCE_TRANSSNIPPET_DESTLANG_BING:PREFERENCE_TRANSSNIPPET_SRCLANG_BING));var text=(showTranslated==true?elemLI.SimpleHighlight.aHighlight.translatedSnippet:elemLI.SimpleHighlight.aHighlight.snippet);templateCloned.options.autoDetectLanguage=(showTranslated==true?false:(templateCloned.options.language==""?true:false));if(templateCloned.options.autoDetectLanguage==true)
templateCloned.options.language="en";chrome.extension.sendRequest({msg:"requestTip",tipTemplate:templateCloned,text:text,msgSet:_msgSetPopupSpeakSnippet,index:elemLI.SimpleHighlight.indexRelativeToMessage});}}}
function OnClickLookupHighlight(e){e.returnValue=false;chrome.tabs.sendRequest(e.currentTarget.tabId,{msg:e.currentTarget.msgLookupHighlight,index:GetListItemFromParents(e.currentTarget).SimpleHighlight.indexRelativeToMessage},function(){if(e.ctrlKey==false&&GetPreference(PREFERENCE_POPUP_PIN)!=PREFBOOL_TRUE)
window.close();});}
function OnClickRemoveHighlight(e,deleteContents){e.returnValue=false;chrome.tabs.sendRequest(e.currentTarget.tabId,{msg:e.currentTarget.msgRemoveHighlight,index:GetListItemFromParents(e.currentTarget).SimpleHighlight.indexRelativeToMessage,deleteContents:(deleteContents==null?false:deleteContents)},function(){liCount=document.getElementsByTagName("li").length;ClearList();PopulateList();if(liCount==1||(e.ctrlKey==false&&GetPreference(PREFERENCE_POPUP_PIN)!=PREFBOOL_TRUE))
window.close();});}
function OnClickHighlight(e){e.preventDefault(true);chrome.tabs.sendRequest(e.target.tabId,{msg:e.shiftKey==true?e.target.msgSelectHighlight:e.target.msgScrollIntoView,index:GetListItemFromParents(e.target).SimpleHighlight.indexRelativeToMessage,alignToTop:e.altKey==true?false:true});if(e.metaKey!=true){if(GetPreference(PREFERENCE_POPUP_PIN)==PREFBOOL_TRUE){if(e.ctrlKey==true)
window.close();}
else{if(e.ctrlKey!=true)
window.close();}}}
function OnClickAddNote(e){e.returnValue=false;var elemLI=GetElementFromIndex(GetListItemIndexFromParents(e.currentTarget));if(elemLI==null)
return;if(elemLI.SimpleHighlight.arrayInfo.note==null||elemLI.SimpleHighlight.arrayInfo.note.length==0){textArea=document.createElement("textarea");textArea.className=CLASS_TEXTAREA_EDITNOTE;textArea.value=INNERTEXT_EMPTYNOTE;textArea.anchor=e.currentTarget;textArea.rows=ROWS_NOTE;textArea.title=TOOLTIP_TEXTAREA;textArea.hasChanged=false;e.currentTarget.parentNode.parentNode.appendChild(document.createElement("br"));e.currentTarget.parentNode.parentNode.appendChild(textArea);textArea.select();textArea.addEventListener("change",OnTextAreaChange);textArea.addEventListener("blur",OnTextAreaBlur);}}
function OnClickRemoveNote(e){e.returnValue=false;var elemLI=GetElementFromIndex(GetListItemIndexFromParents(e.currentTarget));if(elemLI==null)return;if(elemLI.SimpleHighlight.arrayInfo.note!=null){chrome.tabs.sendRequest(e.currentTarget.tabId,{msg:e.currentTarget.msgSetNote,index:GetListItemFromParents(e.currentTarget).SimpleHighlight.indexRelativeToMessage,data:{note:null}},function(){ClearList();PopulateList();});}}
function OnClickNote(event){textArea=document.createElement("textarea");textArea.value=event.target.innerText;textArea.className=CLASS_TEXTAREA_EDITNOTE;textArea.rows=ROWS_NOTE;textArea.title=TOOLTIP_TEXTAREA;textArea.hasChanged=false;textArea.anchor=event.target;event.target.parentNode.replaceChild(textArea,event.target);textArea.focus();textArea.addEventListener("change",OnTextAreaChange);textArea.addEventListener("blur",OnTextAreaBlur);}
function OnTextAreaChange(event){event.currentTarget.hasChanged=true;}
function OnTextAreaBlur(event){if(event.currentTarget.hasChanged==true){chrome.tabs.sendRequest(event.currentTarget.anchor.tabId,{msg:event.currentTarget.anchor.msgSetNote,index:GetListItemFromParents(event.currentTarget).SimpleHighlight.indexRelativeToMessage,data:{note:event.currentTarget.value}},function(){ClearList();PopulateList();});}
else{ClearList();PopulateList();}}
function OnClickPrevNext()
{_OnClickPrevNext(this);}
function _OnClickPrevNext(anchor){elements=document.getElementsByTagName("li");if(elements.length==0)
return;if(_indexCurrentHighlight!=null){elements[_indexCurrentHighlight].style["margin-left"]="";elements[_indexCurrentHighlight].SimpleHighlight.aHighlight.style.zoom=1;}
if(typeof anchor=="string")
id=anchor;else
id=anchor.id;if(id=="prev"){if(_indexCurrentHighlight==null||_indexCurrentHighlight==0)
_indexCurrentHighlight=elements.length-1;else
_indexCurrentHighlight--;}
else if(id=="next"){if(_indexCurrentHighlight==null||_indexCurrentHighlight==(elements.length-1))
_indexCurrentHighlight=0;else
_indexCurrentHighlight++;}
else if(id=="top"){_indexCurrentHighlight=0;}
else if(id=="bottom"){_indexCurrentHighlight=elements.length-1;}
else if(id=="cancel"){document.getElementById("cancel").style.display="none";return;}
document.getElementById("cancel").style.display='';var aHighlight=GetElementFromIndex(_indexCurrentHighlight,CLASS_HL);if(aHighlight==null)return;elements[_indexCurrentHighlight].style["margin-left"]="-1.5em";aHighlight.style.zoom=1.3;var mouseClickEvent=document.createEvent("MouseEvent");mouseClickEvent.initMouseEvent("click",true,true,window,0,0,0,0,0,event.ctrlKey,event.altKey,event.shiftKey,true,0,null);aHighlight.dispatchEvent(mouseClickEvent);elements[_indexCurrentHighlight].scrollIntoView(false);}
function OnClickPin(){try{SetPreference(PREFERENCE_POPUP_PIN,GetPreference(PREFERENCE_POPUP_PIN)==PREFBOOL_TRUE?PREFBOOL_FALSE:PREFBOOL_TRUE);}catch(e){return;}
UpdateHeader();}
function OnClickRemoveAllHighlights(){chrome.tabs.executeScript(document.SimpleHighlight.tab.id,{code:'if(typeof(RemoveAllHighlights) === "function") RemoveAllHighlights();',allFrames:true});window.close();}
function OnClickSave(){if(document.SimpleHighlight.tab.url.length==0)
return;chrome.tabs.executeScript(document.SimpleHighlight.tab.id,{code:'SaveHighlights("'+this.id+'");',allFrames:true},function(){});window.close();}
function OnClickUnSave(){if(document.SimpleHighlight.tab.url.length==0)
return;chrome.extension.sendRequest({msg:"saveHighlights",url:document.SimpleHighlight.tab.url.RemoveHash(),arrayHighlights:null,store:"both"},function(result){if(result.res==null){chrome.tabs.executeScript(document.SimpleHighlight.tab.id,{code:'if(typeof(SetDirty) === "function") SetDirty(true, {ignoreAutoSave: true} );',allFrames:true},function(){});}
window.close();});}
function OnClickVisibilityButtons()
{_OnClickVisibilityButtons(this);}
function _OnClickVisibilityButtons(anchor){if(ENABLE_ALLTRANS==true){if(anchor.id==ID_ANCHOR_ALLTRANS)
ShowAllTranslatedSnippets(anchor.show);}
if(anchor.id==ID_ANCHOR_ALLNOTES)
ShowAllNotes(anchor.show);SetSelectedButtonState(anchor.id,anchor.show==true?false:true);}
function OnClickQuickLanguageButton(){var div=document.getElementById(ID_DIV_QUICKLANGUAGEBAR);if(div==null)
return;if(div.style.display=="none"){var aQL=document.getElementById(ID_ANCHOR_QUICKLANGUAGE);aQL.getElementsByClassName(CLASS_HEADERBUTTONIMAGE)[0].classList.add(CLASS_QL_BUTTONSELECTED);div.style.display="";var numCharCount=new Number(GetPreference(PREFERENCE_TRANSLATEDCHARS));if(isNaN(numCharCount)==true&&numCharCount>(LIMIT_DAILY_TRANSLATEDCHARS*0.5))
document.getElementById(ID_SPAN_QLBAR_TRANSLATEDTODAY).style.setProperty("display","","important");document.getElementById(ID_SPAN_NUMTRANSLATEDCHARS).innerText=AddCommas(GetPreference(PREFERENCE_TRANSLATEDCHARS));}
else
OnClickButtonCloseQuickLanguage();}
function OnClickButtonApplyQuickLanguage(){SetPreference(PREFERENCE_TRANSSNIPPET_SRCLANG_BING,document.getElementById("selectTransHLSrcLang").value);SetPreference(PREFERENCE_TRANSSNIPPET_DESTLANG_BING,document.getElementById("selectTransHLDestLang").value);document.getElementById(ID_BUTTON_QLBAR_SET).disabled=true;document.getElementById(ID_BUTTON_QLBAR_RESET).disabled=false;SetQuickLanguageFlag();chrome.windows.getAll({populate:true},function(arrayWindows){arrayWindows.forEach(function(w){w.tabs.forEach(function(tab){chrome.tabs.executeScript(tab.id,{code:'if(typeof(LoadPreferences) === "function") LoadPreferences({maskTranslation: true});',allFrames:true},null);});});});var elemsLI=document.getElementsByTagName("li");for(var index=0;index<elemsLI.length;index++){elemsLI[index].SimpleHighlight.spanAddRemDel.aInfo.nameSrcLanguage=null;elemsLI[index].SimpleHighlight.aHighlight.translatedSnippet=null;var audio=elemsLI[index].SimpleHighlight.spanAddRemDel.aSpeakSnippet.audio;if(audio){audio.currentTime=99999;audio.parentElement.removeChild(audio);elemsLI[index].SimpleHighlight.spanAddRemDel.aSpeakSnippet.audio=null;}
if(elemsLI[index].SimpleHighlight.showTranslated==true){if(ENABLE_QL_RETRANSLATEALL==true&&(event.altKey==true&&event.shiftKey==true&&event.ctrlKey==true))
ShowTranslatedSnippet(elemsLI[index].SimpleHighlight.showTranslated,index);else
ShowTranslatedSnippet(false,index);}}}
function OnClickButtonResetQuickLanguage(){document.getElementById("selectTransHLSrcLang").value=GetPreference(PREFERENCE_TRANSSNIPPET_SRCLANG_BING,true);document.getElementById("selectTransHLDestLang").value=GetPreference(PREFERENCE_TRANSSNIPPET_DESTLANG_BING,true);OnClickButtonApplyQuickLanguage();document.getElementById(ID_BUTTON_QLBAR_RESET).disabled=true;}
function OnClickButtonCloseQuickLanguage(){var div=document.getElementById(ID_DIV_QUICKLANGUAGEBAR);if(div){div.style.display="none";var aQL=document.getElementById(ID_ANCHOR_QUICKLANGUAGE);aQL.getElementsByClassName(CLASS_HEADERBUTTONIMAGE)[0].classList.remove(CLASS_QL_BUTTONSELECTED);}}
function OnChangeQuickTransLanguage(){document.getElementById(ID_BUTTON_QLBAR_SET).disabled=false;}
function OnClickButtonDetailAllHighlights(){if(document.SimpleHighlight.tab.url.length==0)
return;event.cancelBubble=true;event.stopPropagation();_reportedFrameCount=_registeredFrameCount=0;_arrDetailHighlights=[];_saveDetailHighlights=event.altKey;_relativeDateDetailHighlights=event.shiftKey;chrome.tabs.executeScript(document.SimpleHighlight.tab.id,{code:'RegisterFrameInPopup('+JSON.stringify({msgRegisterFrame:MSG_REGISTERFRAME})+');',allFrames:true});chrome.tabs.executeScript(document.SimpleHighlight.tab.id,{code:'DetailPageHighlights('+JSON.stringify({msgOnDetailHighlightsFrame:MSG_ONDETAILHIGHLIGHTSFRAME})+');',allFrames:true});}
function OnClickExport(){if(document.SimpleHighlight.tab.url.length==0)
return;_reportedFrameCount=_registeredFrameCount=0;_exportAsXml=(event.ctrlKey==true&&event.altKey==true&&event.shiftKey==true)?true:false;chrome.extension.sendRequest({msg:"saveHighlights",url:KEYNAME_EXPORTPAGEHIGHLIGHTS,store:"session",arrayHighlights:null});chrome.tabs.executeScript(document.SimpleHighlight.tab.id,{code:'RegisterFrameInPopup('+JSON.stringify({msgRegisterFrame:MSG_REGISTERFRAME})+');',allFrames:true});chrome.tabs.executeScript(document.SimpleHighlight.tab.id,{code:'ExportPageHighlights('+JSON.stringify({key:KEYNAME_EXPORTPAGEHIGHLIGHTS,msgOnExportFrame:MSG_ONEXPORTEDFRAME})+');',allFrames:true});}
function OnClickButtonImport(){var div=document.getElementById(ID_DIV_IMPORTBAR);if(div.style.display==""){OnClickButtonImportBarClose();return;}
if(event.altKey==true){var xhr=new XMLHttpRequest();var url=prompt(PROMPT_IMPORTURL_MESSAGE,PROMPT_IMPORTURL_DEFAULTVALUE);if(url==null)
return;xhr.open('GET',url,true);xhr.onreadystatechange=function(aEvt){if(xhr.readyState==4){if(xhr.status==200){DoImport(xhr.responseText);}}};xhr.send(null);}
else{document.getElementById("btnHiddenImport").click();}}
function OnChangeImport(){var files=this.files;for(var i=0,f;f=files[i];i++){var reader=new FileReader();reader.onload=(function(theFile){return function(e){DoImport(e.target.result);};})(f);reader.readAsText(f);}}
function DoImport(stringifiedImportObject){chrome.extension.sendRequest({msg:"getHighlightsFromStringifiedImportObject",stringifiedImportObject:stringifiedImportObject},function(res){if(res.error){alert("Error: "+res.error);return;}
var urlTabWithHashRemoved=document.SimpleHighlight.tab.url.RemoveHash();if(res.arr.length>=1){if(res.arr.length==1){if(res.arr[0].url&&res.arr[0].url==urlTabWithHashRemoved){chrome.tabs.executeScript(document.SimpleHighlight.tab.id,{code:'PlayIntoJournal('+
JSON.stringify(res.arr[0].hl)+');',allFrames:true},null);window.close();return;}}
var div=document.getElementById(ID_DIV_IMPORTBAR);div.style.display="";var aImport=document.getElementById(ID_ANCHOR_IMPORT);aImport.getElementsByClassName(CLASS_HEADERBUTTONIMAGE)[0].classList.add(CLASS_IMPORT_BUTTONSELECTED);var select=document.getElementById(ID_SELECT_IMPORTURL);select.options.length=0;for(var p=0;p<res.arr.length;p++){if(!res.arr[p].url)
continue;var option=new Option(res.arr[p].url,res.arr[p].url);option.hl=res.arr[p].hl;select.options.add(option);}
select.value=urlTabWithHashRemoved;if(select.selectedIndex==-1){document.getElementById(ID_SPAN_IMPORTBARTEXT).style.display="";select.selectedIndex=0;}
OnChangeSelectImport();}});}
function OnChangeSelectImport(){var select=document.getElementById(ID_SELECT_IMPORTURL);document.getElementById(ID_BUTTON_IMPORTBAR_GOTOURL).disabled=(select.value==document.SimpleHighlight.tab.url.RemoveHash()?true:false);}
function OnClickButtonImportBarImport(){var select=document.getElementById(ID_SELECT_IMPORTURL);if(select.selectedIndex==-1)
return;var option=select.options[select.selectedIndex];var urlTabWithHashRemoved=document.SimpleHighlight.tab.url.RemoveHash();var ignoreMismatchedURL=false;if(option.value!=urlTabWithHashRemoved){if(confirm(CONFIRM_FORCEIMPORT)!=true)
return;ignoreMismatchedURL=true;}
chrome.tabs.executeScript(document.SimpleHighlight.tab.id,{code:'PlayIntoJournal('+
JSON.stringify(option.hl)+');',allFrames:true});window.close();}
function OnClickButtonImportBarGotoURL(){var select=document.getElementById(ID_SELECT_IMPORTURL);if(select.value==null)
return;window.open(select.value,"_blank");window.close();}
function OnClickButtonImportBarClose(){var div=document.getElementById(ID_DIV_IMPORTBAR);div.style.display="none";var aImport=document.getElementById(ID_ANCHOR_IMPORT);aImport.getElementsByClassName(CLASS_HEADERBUTTONIMAGE)[0].classList.remove(CLASS_IMPORT_BUTTONSELECTED);}
function OnClickButtonRemoveDonate(){var div=document.getElementById(ID_DIV_DONATE);div.style.display="none";SetPreference(PREFERENCE_POPUP_REMOVEDONATE,PREFBOOL_TRUE);}
function SetQuickLanguageFlag(){var destLanguage=GetPreference(PREFERENCE_TRANSSNIPPET_DESTLANG_BING);var destLangInfo=Bing.GetLanguageInfo(destLanguage);var srcLanguage=GetPreference(PREFERENCE_TRANSSNIPPET_SRCLANG_BING);var srcLangInfo=Bing.GetLanguageInfo(srcLanguage);var imgFlag=document.getElementById(ID_BUTTON_QLBAR_SRCFLAG);imgFlag.src=srcLangInfo.urlFlag;imgFlag.title=TOOLTIP_QLBARSRCFLAG.replace("<<LANGUAGE>>",srcLangInfo.name?srcLangInfo.name:"?");imgFlag=document.getElementById(ID_BUTTON_QLBAR_DESTFLAG);imgFlag.src=destLangInfo.urlFlag;imgFlag.title=TOOLTIP_QLBARDESTFLAG.replace("<<LANGUAGE>>",destLangInfo.name?destLangInfo.name:"?");}
function ClearList(){_indexCurrentHighlight=null;_totalNumHighlights=0;if(document.SimpleHighlight&&document.SimpleHighlight.tab)
chrome.tabs.sendRequest(document.SimpleHighlight.tab.id,{msg:"setPopupPageYOffset",popupPageYOffset:window.pageYOffset});_disableStorePopupPageYOffset=true;var ol=document.getElementById(ID_OL_HIGHLIGHTS);if(ol!=null&&ol.parentNode!=null)
ol.parentNode.removeChild(ol);UpdateHeader();}
function PopulateList(){chrome.tabs.getSelected(null,function(tab){document.SimpleHighlight={tab:tab,};UpdateStorageIcons(tab);if(tab.url.length==0)
return;chrome.tabs.sendRequest(tab.id,{msg:"getPopupPageYOffset"},function(offset){_pageYOffsetTryAfterSnippetSent=offset;_disableStorePopupPageYOffset=false;chrome.tabs.executeScript(tab.id,{code:'if(typeof(SendAllSnippets) === "function") SendAllSnippets("'+MSG_SNIPPETSENT+'");',allFrames:true},null);});});}
function UpdateHeader(){document.getElementById('titletext').innerHTML='<span class="number" style="vertical-align:inherit">'+_totalNumHighlights+"</span> Highlight"+(_totalNumHighlights==1?"":"s");document.getElementById(ID_DIV_NOHIGHLIGHTS).style.display=(_totalNumHighlights==0?"":"none");document.getElementById(ID_ANCHOR_EXPORT).style.display=(_totalNumHighlights==0?"none":"");document.getElementById(ID_SPAN_FINDCURSOR).style.display=(_totalNumHighlights==0?'none':'');document.getElementById(ID_ANCHOR_REMOVEALLHIGHLIGHTS).style.display=(_totalNumHighlights==0?'none':'');document.getElementById(ID_BUTTON_SAVELOCAL).style.display=(_totalNumHighlights==0?'none':'');document.getElementById(ID_BUTTON_SAVESESSION).style.display=(_totalNumHighlights==0?'none':'');document.getElementById(ID_BUTTON_DETAILHIGHLIGHTS).style.display=(_totalNumHighlights==0?'none':'');var pinIn=GetPreference(PREFERENCE_POPUP_PIN)==PREFBOOL_TRUE?true:false;var aPin=document.getElementById('pin');if(aPin){aPin.title=(pinIn==true?TOOLTIP_PININ:TOOLTIP_PINOUT);aPin.getElementsByTagName("img")[0].src="img/pin"+(pinIn==false?"Out":"In")+".png";}}
function ShowNote(showNote,index){var elemLI=GetElementFromIndex(index);if(elemLI.SimpleHighlight.divNote!=null){if(showNote==false)
elemLI.SimpleHighlight.divNote.style.setProperty("display","none");else
elemLI.SimpleHighlight.divNote.style.removeProperty("display");}
var imgShowNote=GetElementFromIndex(index,CLASS_SHOWNOTE_IMG);if(imgShowNote!=null){imgShowNote.className=CLASS_SHOWNOTE_IMG;if(showNote==true)
imgShowNote.classList.add(CLASS_BUTTONSELECTED);imgShowNote.parentElement.title=(showNote==true?TOOLTIP_HIDENOTE:TOOLTIP_SHOWNOTE);}
elemLI.SimpleHighlight.showNote=showNote;if(elemLI.SimpleHighlight.spanAddRemDel.aShowNote!=null){chrome.tabs.sendRequest(elemLI.SimpleHighlight.spanAddRemDel.aShowNote.tabId,{msg:elemLI.SimpleHighlight.spanAddRemDel.aShowNote.msgSetShowStatus,index:elemLI.SimpleHighlight.indexRelativeToMessage,itemType:"showNote",show:showNote});}}
function ShowAllNotes(showAllNotes){var elemsLI=document.getElementsByTagName("li");for(var x=0;x<elemsLI.length;x++)
ShowNote(showAllNotes,x);}
function ShowTranslatedSnippet(showTranslated,index){var elemLI=GetElementFromIndex(index);if(elemLI==null||elemLI.SimpleHighlight.aHighlight==null)
return;var aHighlight=elemLI.SimpleHighlight.aHighlight;var spanWaiting=elemLI.SimpleHighlight.spanWaiting;if(showTranslated==true&&(aHighlight.translatedSnippet==null||aHighlight.translatedSnippet.length==0)){if(spanWaiting){spanWaiting.style.display="";if(spanWaiting.timerID!=null)
clearTimeout(spanWaiting.timerID);spanWaiting.timerID=setTimeout(function(paramImg,paramIndex){OnSetPopupTranslatedSnippet(index,{error:ERROR_IMGWAITING});},TIMEOUT_IMGWAITING,spanWaiting,index);}
var template=null;var idMatch=ID_TIPPOPUP_MSTRANSLATE_TRANSLATE;for(var y in _arrTipPopupMasterTemplates){if(_arrTipPopupMasterTemplates[y].id==idMatch){template=_clone(_arrTipPopupMasterTemplates[y]);break;}}
if(template){if(template.options==null)
template.options={};template.sessionData={};template.options.srcLang=GetPreference(PREFERENCE_TRANSSNIPPET_SRCLANG_BING);template.options.destLang=GetPreference(PREFERENCE_TRANSSNIPPET_DESTLANG_BING);for(var q in template.defaultOptions){if(template.options[q]===undefined)
template.options[q]=template.defaultOptions[q];}
chrome.extension.sendRequest({msg:"requestTip",tipTemplate:template,text:aHighlight.snippet,msgSet:_msgSetPopupTranslatedSnippet,index:elemLI.SimpleHighlight.indexRelativeToMessage});}
return;}
elemLI.SimpleHighlight.showTranslated=showTranslated;var imgTranslate=GetElementFromIndex(index,CLASS_SHOWTRANSHL_IMG);if(imgTranslate){imgTranslate.className=CLASS_SHOWTRANSHL_IMG;if(showTranslated==true){imgTranslate.classList.add(CLASS_BUTTONSELECTED);imgTranslate.parentElement.title=TOOLTIP_HIDETRANSHL;}
else{var destLanguage=elemLI.SimpleHighlight.aAppendedTranslation.spanSource.nameDestLanguage;var title=TOOLTIP_SHOWTRANSHL;imgTranslate.parentElement.title=title.replace("<<LANGUAGE>>",destLanguage!=null?destLanguage:"destination language");}}
if(showTranslated==false&&spanWaiting){spanWaiting.style.display="none";if(spanWaiting.timerID!=null){clearTimeout(spanWaiting.timerID);spanWaiting.timerID=null;}}
var aShowTransHL=elemLI.SimpleHighlight.spanAddRemDel.aShowTransHL;if(aShowTransHL){chrome.tabs.sendRequest(aShowTransHL.tabId,{msg:aShowTransHL.msgSetShowStatus,index:elemLI.SimpleHighlight.indexRelativeToMessage,itemType:"showTranslatedSnippet",show:showTranslated});}
if(showTranslated==true){elemLI.SimpleHighlight.aAppendedTranslation.spanText.innerText=aHighlight.translatedSnippet;if(elemLI.SimpleHighlight.styleTranslation=="replace")
elemLI.SimpleHighlight.aAppendedTranslation.title=TOOLTIP_SOURCESNIPPET.replace("<<SNIPPET>>",aHighlight.snippet);else
elemLI.SimpleHighlight.aAppendedTranslation.title="";var title=TOOLTIP_TRANSLATEDSNIPPET_SPANSOURCE_FROMTO;title=title.replace("<<SRCLANGUAGE>>",elemLI.SimpleHighlight.aAppendedTranslation.spanSource.nameSrcLanguage);title=title.replace("<<DESTLANGUAGE>>",elemLI.SimpleHighlight.aAppendedTranslation.spanSource.nameDestLanguage);elemLI.SimpleHighlight.aAppendedTranslation.spanSource.title=title;elemLI.SimpleHighlight.aAppendedTranslation.spanSource.imgFlag.src=elemLI.SimpleHighlight.aAppendedTranslation.spanSource.urlSrcLanguageIcon;}
elemLI.SimpleHighlight.aAppendedTranslation.style.setProperty("display",showTranslated==true?"":"none");elemLI.SimpleHighlight.aAppendedTranslation.style.setProperty("margin-left",(elemLI.SimpleHighlight.styleTranslation=="replace"?0.2:0.5)+"em");if(elemLI.SimpleHighlight.styleTranslation=="replace"){elemLI.SimpleHighlight.aHighlight.style.setProperty("display",showTranslated==true?"none":"","important");}
if(showTranslated==true){elemLI.style.setProperty("border-radius","5px","important");elemLI.style.setProperty("background-color",COLOUR_TRANSLATEDSNIPPET,"important");}
else{elemLI.style.removeProperty("background-color");elemLI.style.removeProperty("border-radius");}
var elemsLI=document.getElementsByTagName("li");var showTranslatedByBranding=elemLI.SimpleHighlight.showTranslated;if(showTranslatedByBranding!=true){for(var x=0;x<elemsLI.length;x++){if(elemsLI[x].SimpleHighlight&&elemsLI[x].SimpleHighlight.showTranslated==true){showTranslatedByBranding=true;break;}}}
document.getElementById("translationsBy").style.setProperty("display",showTranslatedByBranding==true?"":"none","important");OnListitemMouseOut({currentTarget:elemLI});}
function ShowAllTranslatedSnippets(showAllTranslatedSnippets){var elemsLI=document.getElementsByTagName("li");for(var x=0;x<elemsLI.length;x++)
ShowTranslatedSnippet(showAllTranslatedSnippets,x);}
function SetSelectedButtonState(id,show){var anchor=document.getElementById(id);if(anchor==null)
return;var itemType;if(ENABLE_ALLTRANS==true){if(id==ID_ANCHOR_ALLTRANS){if(show==false)
anchor.title=TOOLTIP_HIDETRANSLATIONS;else{var title=TOOLTIP_SHOWTRANSLATIONS;var destLanguage=Bing.GetLanguageInfo(GetPreference(PREFERENCE_TRANSSNIPPET_DESTLANG_BING)).name;anchor.title=title.replace("<<LANGUAGE>>",destLanguage!=null?destLanguage:"?");}
itemType="showAllTrans";}}
if(id==ID_ANCHOR_ALLNOTES){anchor.title=(show==true?TOOLTIP_SHOWNOTES:TOOLTIP_HIDENOTES);itemType="showAllNotes";}
var img=anchor.getElementsByTagName("img")[0];img.classList[(show==false?"add":"remove")](CLASS_BUTTONSELECTED);anchor.show=show;if(anchor.lastValidTabId){chrome.tabs.sendRequest(anchor.lastValidTabId,{msg:anchor.msgSetShowStatus,itemType:itemType,show:show});}}
function UpdateStorageIcons(tab){var now=new Date();var dateString=now.toDateString(now);if(dateString!=GetPreference(PREFERENCE_TRANSLATEDCHARS_DATESTRING)){SetPreference(PREFERENCE_TRANSLATEDCHARS_DATESTRING,dateString);SetPreference(PREFERENCE_TRANSLATEDCHARS,0);}
var numCharCount=new Number(GetPreference(PREFERENCE_TRANSLATEDCHARS));if(isNaN(numCharCount)==false&&numCharCount>LIMIT_DAILY_TRANSLATEDCHARS){document.getElementById('infobar').innerHTML=INFOBAR_TRANSLATEDCHARS;document.getElementById('infobar').style.display='';}
else if(tab.incognito){document.getElementById('infobar').innerHTML=INFOBAR_INCOGNITO;document.getElementById('infobar').style.display='';}
chrome.extension.sendRequest({msg:"getURLStore",url:tab.url.RemoveHash()},function(store){document.getElementById(ID_BUTTON_DELETESTORAGE).style.display=(store==null?"none":"");document.getElementById("header").className=(store=="session"?"colourSession":(store=="local"?"colourLocal":"colourNoStore"));document.getElementById("titletext").title=(store=="session"?TOOLTIP_TITLEBAR_SESSION:(store=="local"?TOOLTIP_TITLEBAR_LOCAL:TOOLTIP_TITLEBAR_UNSAVED));});}
function PopulateLanguages(id,args){var elemSelect=document.getElementById(id);if(elemSelect==null)
return;if(args&&args.prependAuto==true){var option=new Option(LANGUAGENAME_AUTO,"");option.className="translateAnything";elemSelect.options.add(option);}
if(args&&args.bing==true){for(var x in Bing.arrLanguageNames){elemSelect.options.add(new Option(Bing.arrLanguageNames[x].name,Bing.arrLanguageNames[x].value));}}
else{for(var x in GoogleAPI.arrLanguages){if(GoogleAPI.arrLanguages[x].supported==true)
elemSelect.options.add(new Option(GoogleAPI.arrLanguages[x].name,GoogleAPI.arrLanguages[x].code));}}}
function GetElementFromIndex(idx,className){var elemsLI=document.getElementsByTagName("li");if(idx>=elemsLI.length)
return null;if(className!=null){var elems=elemsLI[idx].getElementsByClassName(className);if(elems.length!=1)
return null;else
return elems[0];}
else
return elemsLI[idx];}
function GetListItemFromParents(elem){while(elem&&elem.nodeName!="LI")
elem=elem.parentNode;return elem;}
function GetListItemIndexFromParents(elem){elem=GetListItemFromParents(elem);if(elem==null)
return-1;var elemsLI=elem.parentNode.children;for(var i=0;i<elemsLI.length;i++){if(elemsLI[i]==elem)
return i;}
return-1;}
function GetAnchorFromClassName(className){if(_currentTargetListItemMouseOver==null)
return null;var elems=_currentTargetListItemMouseOver.getElementsByClassName(className);return(elems.length==1?elems[0]:null);}